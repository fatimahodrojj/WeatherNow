<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>City • WeatherNow</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800;900&family=Sora:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-1:#371F9B; --bg-2:#4a2bbf; --bg-3:#6636FF;
    --card-1:rgba(255,255,255,.14); --card-2:rgba(255,255,255,.06);
    --txt:#F6F3FF;
  }
  html,body{height:100%}
  body{
    margin:0; color:var(--txt);
    font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background: radial-gradient(1200px 800px at 50% 10%, var(--bg-3) 0%, var(--bg-2) 40%, var(--bg-1) 100%);
    overflow-x:hidden;
  }

  /* twinkles for this page too */
  .tw{position:fixed;width:3px;height:3px;border-radius:50%;
      background:radial-gradient(circle,#FFE27A 40%,transparent 60%);
      opacity:.9; animation:t 2s ease-in-out infinite}
  @keyframes t{0%,100%{transform:scale(.8);opacity:.8}50%{transform:scale(1.25);opacity:1}}

  .wrap{ max-width:1200px; margin-inline:auto; padding:28px clamp(16px,5vw,32px); }

  .top{
    width:100%;
    padding:18px 22px; border-radius:22px;
    background:linear-gradient(120deg,var(--card-1),var(--card-2));
    backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
    display:grid; grid-template-columns:1fr auto; align-items:center; gap:16px;
    box-shadow:0 18px 48px rgba(0,0,0,.30);
  }

  #cityTitle{
    margin:0; line-height:1.05;
    font-size: clamp(34px,6.2vw,56px); font-weight:900;
    background:linear-gradient(90deg,#9CF2FF,#9C8BFF,#FF96E0,#FFD86F);
    -webkit-background-clip:text;background-clip:text;color:transparent;
  }
  .meta{ text-align:right; font-weight:600; opacity:.95 }

  .grid{
    display:grid; gap:28px; margin-top:24px;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
  }
  .card{
    padding:26px 24px; border-radius:22px;
    background:linear-gradient(120deg,var(--card-1),var(--card-2));
    box-shadow:0 18px 48px rgba(0,0,0,.30);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  }
  .tag{ opacity:.85; font-weight:800; letter-spacing:.4px; margin-bottom:14px }
  .temp{
    font-size: clamp(36px,6vw,48px); font-weight:900; margin: 6px 0 4px;
  }
  .sub{ font-weight:600; opacity:.95 }
</style>
</head>
<body>
<div class="wrap">
  <header class="top">
    <h1 id="cityTitle">Beirut, <span id="cc">LB</span></h1>
    <div class="meta"><span id="localTime">Local time · …</span></div>
  </header>

  <section class="grid" id="cards">
    <article class="card">
      <div class="tag">Yesterday</div>
      <div class="temp" id="y-temp">--° / --°</div>
      <div class="sub" id="y-desc">—</div>
      <div class="sub" id="y-rain">Rain: — mm</div>
    </article>

    <article class="card">
      <div class="tag">Today</div>
      <div class="temp" id="t-temp">--° / --°</div>
      <div class="sub" id="t-desc">—</div>
      <div class="sub" id="t-rain">Rain: — mm</div>
    </article>

    <article class="card">
      <div class="tag">Tomorrow</div>
      <div class="temp" id="tm-temp">--° / --°</div>
      <div class="sub" id="tm-desc">—</div>
      <div class="sub" id="tm-rain">Rain: — mm</div>
    </article>
  </section>
</div>

<script>
  // Twinkles on this page
  (function tw(){
    const N=90, f=document.createDocumentFragment();
    for(let i=0;i<N;i++){const s=document.createElement('span');s.className='tw';
      s.style.left=(Math.random()*100)+'vw'; s.style.top=(Math.random()*100)+'vh';
      s.style.position='fixed'; s.style.animationDelay=(Math.random()*2)+'s';
      f.appendChild(s)
    } document.body.appendChild(f);
  })();

  // Small lat/lon table for capitals we listed on the home page
  const coords = {
    LB:[33.8938,35.5018], AE:[24.4539,54.3773], SA:[24.7136,46.6753], QA:[25.2854,51.5310],
    KW:[29.3759,47.9774], OM:[23.5880,58.3829], BH:[26.2235,50.5876], EG:[30.0444,31.2357],
    TR:[39.9255,32.8663], JO:[31.9539,35.9106], SY:[33.5138,36.2765], IQ:[33.3152,44.3661],
    YE:[15.3694,44.1910], IR:[35.6892,51.3890], DE:[52.5200,13.4050], FR:[48.8566,2.3522],
    ES:[40.4168,-3.7038], IT:[41.9028,12.4964], GB:[51.5072,-0.1276], US:[38.9072,-77.0369],
    CA:[45.4215,-75.6972], BR:[-15.8267,-47.9218], AR:[-34.6037,-58.3816], MX:[19.4326,-99.1332],
    IN:[28.6139,77.2090], CN:[39.9042,116.4074], JP:[35.6762,139.6503], KR:[37.5665,126.9780],
    AU:[-35.2809,149.1300], ZA:[-25.7461,28.1881]
  };

  // Title + time
  (function initTitleAndTime(){
    const p=new URLSearchParams(location.search);
    const city=p.get('city')||'Beirut';
    const cc=(p.get('cc')||'LB').toUpperCase();
    const tt=document.getElementById('cityTitle');
    tt.firstChild.nodeValue=`${city}, `;
    document.getElementById('cc').textContent=cc;

    function tick(){
      const now=new Date();
      const fmt=new Intl.DateTimeFormat('en-GB',{
        timeZone:'Asia/Beirut',
        weekday:'short', day:'2-digit', month:'2-digit', year:'numeric',
        hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:true
      });
      document.getElementById('localTime').textContent=`Local time · ${fmt.format(now)}`;
    }
    tick(); setInterval(tick,1000);

    loadWeather(cc);
  })();

  async function loadWeather(cc){
    // default to Beirut if unknown
    const [lat,lon]=(coords[cc]||coords['LB']);
    // Open-Meteo (no key needed)
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&timezone=auto&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum&past_days=1&forecast_days=2`;
    try{
      const r=await fetch(url); const j=await r.json();
      const d=j.daily;

      // indices: [yesterday, today, tomorrow]
      fill('y', d.temperature_2m_max[0], d.temperature_2m_min[0], d.precipitation_sum[0], d.weathercode[0]);
      fill('t', d.temperature_2m_max[1], d.temperature_2m_min[1], d.precipitation_sum[1], d.weathercode[1]);
      fill('tm', d.temperature_2m_max[2], d.temperature_2m_min[2], d.precipitation_sum[2], d.weathercode[2]);
    }catch(e){
      console.error(e);
    }
  }

  function wmoToText(code){
    // minimal mapping
    if([0].includes(code)) return 'Clear';
    if([1,2].includes(code)) return 'Mostly clear';
    if([3].includes(code)) return 'Overcast';
    if([45,48].includes(code)) return 'Fog';
    if([51,53,55,56,57].includes(code)) return 'Drizzle';
    if([61,63,65,66,67,80,81,82].includes(code)) return 'Rain';
    if([71,73,75,77,85,86].includes(code)) return 'Snow';
    if([95,96,99].includes(code)) return 'Thunderstorm';
    return '—';
  }
  function round1(x){ return (Math.round(x*10)/10).toFixed(1) }

  function fill(prefix, tmax,tmin,rain,code){
    document.getElementById(`${prefix}-temp`).textContent = `${Math.round(tmax)}° / ${Math.round(tmin)}°`;
    document.getElementById(`${prefix}-desc`).textContent = wmoToText(code);
    document.getElementById(`${prefix}-rain`).textContent = `Rain: ${round1(rain)} mm`;
  }
</script>
</body>
</html>
